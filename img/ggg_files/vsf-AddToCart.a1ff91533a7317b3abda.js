(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{1501:function(t,e,o){"use strict";o.r(e);var r=o(12),i=o(248),a=o(605),n=o(600),s=o(204),c=o(14),u=o(2),d=o(1),l=o(6);function p(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function b(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function f(t,e,o,r,i,a,n){try{var s=t[a](n),c=s.value}catch(t){return void o(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function m(t){return function(){var e=this,o=arguments;return new Promise((function(r,i){var a=t.apply(e,o);function n(t){f(a,r,i,n,s,"next",t)}function s(t){f(a,r,i,n,s,"throw",t)}n(void 0)}))}}var h={closeIcon:!0,autoClose:!0,autoCloseDuration:5e3,show:!0},v={directives:{focusClean:a.a},components:{ButtonFull:n.a},data:function(){return{isAddedToCart:!1,protectionServiceProduct:null,activeButton:!1,PSUpdateStatus:!1}},props:{product:{required:!0,type:Object},disabled:{type:Boolean,default:!1},itemQty:{type:Number,default:void 0},cartLabel:{type:String,default:""},cartButtonColor:{type:String,default:""},iconId:{type:String,default:""},buttonClass:{type:String,default:""},isIconSmall:{type:Boolean,default:!1},preOrder:{type:Boolean,default:!1},isButtonFluid:{type:Boolean,default:!1},isButtonFloating:{type:Boolean,default:!1},isButtonWhite:{type:Boolean,default:!1},stockData:{required:!1,type:Object,default:null},loading:{type:Boolean,default:!1},sectionLabel:{type:String,required:!1,default:""}},methods:{isKuwaitSite:function(){return"en-KW"!==Object(l.b)().localeSwitch&&"ar-KW"!==Object(l.b)().localeSwitch},getCartLabel:function(){var t="Add to Cart";return"NOT_ONLINE"===this.product.display_button?"Not Available Online":"SOLD_OUT"===this.product.display_button?"Sold Out":(this.isDigitalFulfilment||(this.cartLabel?t=this.cartLabel:this.stockData?this.itemQty>0&&this.product.min_sale_qty>this.itemQty||this.itemQty<=0&&("OX_ITEM"===this.product.display_button&&"OUTOFSTOCK"===this.stockData.stock_availablity||"PREORDER"===this.stockData.stock_availablity)?t="Sold Out":this.itemQty<=0&&"OUTOFSTOCK"===this.stockData.stock_availablity?(t="Not Available Online",this.$parent.getCurrentProduct&&(this.$parent.stockDisplayButton="NOT_ONLINE")):this.itemQty>0&&"PREORDER"===this.stockData.stock_availablity?(this.$parent.getCurrentProduct&&(this.$parent.getCurrentProduct.hasPreorder=!0),t="Pre-order"):t=this.itemQty>0&&"BACKORDER"===this.stockData.stock_availablity?"Reserve":this.itemQty>0?"Add to Cart":"Out of Stock":t=!1===this.disabled?"Add to Cart":this.product.ox_status>0||!0===this.preOrder?"Sold Out":"Out of Stock"),t)},getProducts:function(t,e){var o=this;if(t){var r=new c.a;return new Promise((function(e,i){try{r=r.applyFilter({key:"sku",value:{in:t}}).applyFilter({key:"visibilityAll",value:{eq:!0}}),o.$store.dispatch("product/list",{query:r,size:8,prefetchGroupProducts:!1,updateState:!1}).then((function(t){t&&(o.protectionServiceProduct=t.items),o.PSUpdateStatus=!1;for(var r=0;r<o.protectionServiceProduct.length;r++)o.$store.dispatch("wordpressCustomApiStore/loadPostBySlug",{slug:o.protectionServiceProduct[r].before_addtocart_popup_block});if(o.protectionServiceProduct){o.$bus.$emit("TPSDATA",{product:o.product,protectionService:o.protectionServiceProduct,PSUpdateStatus:o.getPSUpdateStatus});var i={parent_sku:o.product.sku,sku:o.product.protection_service_sku};o.$bus.$emit("gtm-tps-success",i)}e(!0)}))}catch(t){e(!0)}}))}return[]},getPSUpdateStatus:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.PSUpdateStatus=t;var o=this.product;this.addToCart(o,t,e)},onAfterRemovedVariant:function(){this.$forceUpdate()},addToCartPreLoad:function(t){var e=this;return m(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!e.product.before_addtocart_popup_block){o.next=8;break}e.$store.commit("addToCartPopUpStore/setIsTPS",!1),e.$store.commit("addToCartPopUpStore/setSlug",e.product.before_addtocart_popup_block),e.$store.commit("addToCartPopUpStore/setGoButtonText","Cancel"),e.$store.commit("addToCartPopUpStore/setDigitalProduct",e.product),e.$bus.$emit("TPSDATA",{product:e.product,protectionService:null,PSUpdateStatus:e.getPSUpdateStatus}),o.next=16;break;case 8:if(!t.protection_service_sku){o.next=15;break}return o.next=11,e.getProducts(t.protection_service_sku,t.sku);case 11:e.protectionServiceProduct,e.protectionServiceProduct?(e.$store.commit("addToCartPopUpStore/setIsTPS",!0),e.$store.commit("addToCartPopUpStore/setSlug",""),e.$store.commit("addToCartPopUpStore/setGoButtonText","Continue without"),e.$store.commit("addToCartPopUpStore/setProtectionSku",[])):e.addToCart(t),o.next=16;break;case 15:e.addToCart(t);case 16:case"end":return o.stop()}}),o)})))()},addToCart:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return m(regeneratorRuntime.mark((function a(){var n,s,c,d,p;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e,e.$emit("click"),e.activeButton=!0,a.prev=3,t.qty=t.qty<t.min_sale_qty||!t.qty?Math.trunc(t.min_sale_qty||1):Math.trunc(t.qty||1),s=n.$store.state.cart.deliveryCity.countryCode||Object(l.b)().tax.defaultCountry,t.extension_attributes={country_code:s},i&&(t.extension_attributes.add_protection_service=o,t.extension_attributes.protection_service_skus=e.addProtectionSku),a.next=10,e.$store.dispatch("cart/addItem",{productToAdd:t});case 10:if(!(c=a.sent).clientNotifications.length){a.next=21;break}return c.clientNotifications.forEach((function(t){e.notifyUser(t)})),e.isAddedToCart=!0,a.next=16,e.$bus.$emit("modal-hide","modal-add-sucess");case 16:i&&e.$bus.$emit("modal-hide","modal-protection-service"),e.activeButton=!1,e.$bus.$emit("addToCartSuccessPopup",{product:t,PSProduct:{addItem:!1}}),a.next=22;break;case 21:c.serverResponses.length&&((d=c.serverResponses.find((function(e){return e.sku===t.sku})))&&200===d.status&&d.result.status?(e.notifyUser({message:"Product has been added to the cart!"}),e.isAddedToCart=!0,e.activeButton=!1,e.$bus.$emit("addToCartSuccessPopup",{product:t,PSProduct:{addItem:!1}}),p={product:t?[t]:[],list:e.sectionLabel,tps:o},e.$bus.$emit("gtm-add-to-cart-success",p)):(h.icon="error-circle",h.notificationClass="notification--error",h.content=r.a.t(d.result.message),e.$bus.$emit("openNotificationPopup",h),d.code=d.status,u.a.genericerror(d)),i&&e.$bus.$emit("modal-hide","modal-protection-service"));case 22:e.activeButton=!1,a.next=35;break;case 25:a.prev=25,a.t0=a.catch(3),e.activeButton=!1,e.$store.commit("cart/cart/UPD_ADDING_ITEM",!1),u.a.error(a.t0,"cart")(),h.icon="error-circle",h.notificationClass="notification--error",h.content=r.a.t("Something went wrong, please try later"),e.$bus.$emit("openNotificationPopup",h),i&&e.$bus.$emit("modal-hide","modal-protection-service");case 35:case"end":return a.stop()}}),a,null,[[3,25]])})))()},notifyUser:function(t){h.icon="completed-circle",h.notificationClass="notification--success",h.content=r.a.t(t.message),this.$bus.$emit("openNotificationPopup",h)}},computed:function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(Object(o),!0).forEach((function(e){b(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({},Object(s.c)({isAddingToCart:"cart/getIsAdding",isOrderPlacementEnabled:"getSalesConfigurationsStore/getSiteConfig",addProtectionSku:"addToCartPopUpStore/getProtectionSku"}),{isProductDisabled:function(){return this.disabled||""!==Object(i.a)(this.product.errors)||this.isAddingToCart||!d.stock.stockCheckLabel.includes(this.product.display_button)||"NOT_ONLINE"===this.$parent.stockDisplayButton},isDigitalFulfilment:function(){return d.fulfilmentLabel.includes(this.product.fulfilment_type)},isPreOrder:function(){return!this.cartLabel&&this.stockData&&this.itemQty>0&&"PREORDER"===this.stockData.stock_availablity}}),beforeMount:function(){this.$bus.$on("product-after-removevariant",this.onAfterRemovedVariant)},beforeDestroy:function(){this.$bus.$emit("modal-hide","modal-protection-service"),this.$bus.$off("product-after-removevariant")}},y=o(243),P=Object(y.a)(v,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.isOrderPlacementEnabled.isEnabled?o("ButtonFull",{staticClass:"button--add-to-cart",class:[t.buttonClass,{"button--positive":t.isAddedToCart&&t.isButtonFluid,"button--cl-green":t.isAddedToCart&&t.isButtonWhite,async:t.activeButton||t.loading,"button--secondary":t.isPreOrder}],style:{backgroundColor:t.cartButtonColor,borderColor:t.cartButtonColor},attrs:{disabled:t.isProductDisabled||"Sold Out"===t.getCartLabel(),"data-testid":"addToCart","aria-label":t.$t(t.getCartLabel()),title:t.$t(t.getCartLabel()),icon:"Not Available Online"===t.getCartLabel()||t.isAddedToCart&&t.isButtonFluid?"":t.isAddedToCart&&t.isButtonFloating&&!t.isButtonFluid?"completed-circle":t.isPreOrder?"cart":t.iconId,"icon-small":t.isIconSmall},nativeOn:{click:function(e){return t.addToCartPreLoad(t.product)}}},[t._v("\n  "+t._s(t.isAddedToCart&&t.isButtonWhite?t.$t("Added to Cart"):t.$t(t.getCartLabel()))+"\n")]):t._e()}),[],!1,null,null,null);e.default=P.exports}}]);
//# sourceMappingURL=vsf-AddToCart.a1ff91533a7317b3abda.js.map